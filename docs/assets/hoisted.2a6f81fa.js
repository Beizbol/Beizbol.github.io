import"./hoisted.d5332371.js";class p{x;y;w;h;text;icon;bg;font;color;constructor(e,i,o,c){this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=c,this.bg=o,this.font="16px sans-serif",this.color="#FFFFFF"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawPin(e){e.fillStyle=this.bg,e.fillRect(this.x-24,this.y-this.h/2,this.w,this.h),e.beginPath();const i=this.x+this.w/2-24;e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill(),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.fillStyle=this.color,e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}clone(){return new p({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.icon.src)}}const s=document.getElementById("canvas"),d=s.getContext("2d"),l=document.getElementById("pcanvas"),g=l.getContext("2d"),m=document.getElementById("download");m.onclick=()=>{const t=document.createElement("a");t.download=x,t.href=s.toDataURL(),t.click()};const E=document.getElementById("pick"),h=new Image,u=document.getElementById("icon-img");u.onload=()=>{console.log("icon loaded"),a()};const b=document.getElementById("icons"),y=document.getElementById("pinColor"),I=document.getElementById("pinText");document.getElementById("ptxt");let r=new p({top:20,left:40,width:100,height:30},"Pin Text",y.value,u.src);document.getElementById("cpin");const n={placed:[],held:null,canvasHover:!1,pin_offset_x:0,pin_offset_y:0};a();s.addEventListener("mouseenter",t=>{console.log("entered"),n.canvasHover=!0});s.addEventListener("mouseleave",t=>{n.canvasHover=!1,n.held&&w()});l.addEventListener("mouseenter",t=>{n.pcanvasHover=!0});l.addEventListener("mouseleave",t=>{n.held&&(n.held.move(40,20),a()),n.pcanvasHover=!1});s.addEventListener("mousemove",t=>{if(!n.held||!n.canvasHover)return;const e=s.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;n.held.move(i,o),v()});l.addEventListener("mousemove",t=>{if(!n.held||!n.pcanvasHover)return;const e=l.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;n.held.move(i,o),a()});s.addEventListener("mousedown",t=>{if(!n.canvasHover)return;const e=s.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;for(let c=0;c<n.placed.length;c++){const f=n.placed[c];if(f.isMouseOver(i,o)){s.style.cursor="grabbing",n.held=f,n.placed.pop(c),console.log("Holding pin");return}}});l.addEventListener("mousedown",t=>{if(!n.pcanvasHover)return;const e=l.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;r.isMouseOver(i,o)&&(l.style.cursor="grabbing",n.held=r,console.log("Holding pin"))});function w(){const t=n.held.clone();n.placed.push(t),n.held=null,v()}document.addEventListener("mouseup",t=>{if(s.style.cursor="grab",l.style.cursor="grab",!!n.held){if(n.canvasHover){const e=s.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;n.held.move(i,o),w()}r.move(40,20),a(),n.held=!1,n.pin_offset_x=0,n.pin_offset_y=0}});b.addEventListener("change",t=>{u.src=t.target.value,r.updateIcon(t.target.value),a()});y.addEventListener("change",t=>{preview.style.backgroundColor=t.target.value,a()});I.addEventListener("change",t=>{r.updateText(t.target.value),a()});let x="";E.addEventListener("change",t=>{if(t.target.files.length<1){alert("No image files selected.");return}if(t.target.files.length>1){alert("One image file at a time.");return}const e=t.target.files[0],i=URL.createObjectURL(e);h.src=i,h.onload=()=>{x=e.name.slice(0,-3)+"png",m.disabled=!1;const{width:o,height:c}=h;d.canvas.width=o,d.canvas.height=c,l.style.width=o+"px",s.style.width=o+"px",s.style.height=c+"px",v()}});function v(){d.clearRect(0,0,s.width,s.height),h.src&&d.drawImage(h,0,0);for(let t=0;t<n.placed.length;t++)n.placed[t].drawPin(d);n.held&&n.held.drawPin(d)}function a(){g.clearRect(0,0,g.canvas.width,g.canvas.height),r.drawPin(g),console.log("preview drawn")}
