import"./hoisted.d5332371.js";class u{id;x;y;w;h;text;icon;bg;font;color;constructor(e,i,o,l,d){this.id=d??Math.random()*1e3,this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=l,this.bg=o,this.font="16px sans-serif",this.color="#FFFFFF"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawPin(e){e.fillStyle=this.bg,e.fillRect(this.x-24,this.y-this.h/2,this.w,this.h),e.beginPath();const i=this.x+this.w/2-24;e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill(),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.fillStyle=this.color,e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new u({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.icon.src)}clone(){return new u({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.icon.src,this.id)}}const s=document.getElementById("canvas"),r=s.getContext("2d"),h=document.getElementById("pcanvas"),g=h.getContext("2d"),w=document.getElementById("download");w.onclick=()=>{const t=document.createElement("a");t.download=E,t.href=s.toDataURL(),t.click()};const I=document.getElementById("pick"),p=new Image,f=document.getElementById("icon-img");f.onload=()=>{c()};const b=document.getElementById("icons"),y=document.getElementById("pinColor"),L=document.getElementById("txtColor"),B=document.getElementById("pinText");document.getElementById("ptxt");let a=new u({top:20,left:40,width:100,height:30},"Pin Text",y.value,f.src);document.getElementById("cpin");const n={placed:[],held:null,canvasHover:!1,pin_offset_x:0,pin_offset_y:0};c();s.addEventListener("mouseenter",t=>{n.canvasHover=!0});s.addEventListener("mouseleave",t=>{n.canvasHover=!1,n.held&&x()});h.addEventListener("mouseleave",t=>{n.held&&(n.held.move(40,20),c())});s.addEventListener("mousemove",t=>{if(!n.held||!n.canvasHover)return;const e=s.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;n.held.move(i,o),m()});let v=!1;h.addEventListener("mousemove",t=>{if(!n.held)return;v=!0;const e=h.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;n.held.move(i,o),c()});s.addEventListener("mousedown",t=>{if(!n.canvasHover)return;const e=s.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;for(let l=0;l<n.placed.length;l++){const d=n.placed[l];if(d.isMouseOver(i,o)){s.style.cursor="grabbing",n.held=d,n.placed.splice(l,1);return}}});h.addEventListener("mousedown",t=>{const e=h.getBoundingClientRect(),i=t.clientX-e.left,o=t.clientY-e.top;a.isMouseOver(i,o)&&(h.style.cursor="grabbing",n.held=a)});function x(){n.held&&(v?n.placed.push(n.held.twin()):n.placed.push(n.held.clone()),n.held=null,m())}document.addEventListener("mouseup",t=>{s.style.cursor="grab",h.style.cursor="grab",n.held&&(n.canvasHover&&x(),a.move(40,20),c(),v=!1,n.pin_offset_x=0,n.pin_offset_y=0)});b.addEventListener("change",t=>{const e=t.target;f.src=e.value,a.updateIcon(e.value),c()});y.addEventListener("change",t=>{const e=t.target;a.bg=e.value,c()});L.addEventListener("change",t=>{const e=t.target;a.color=e.value,c()});B.addEventListener("change",t=>{const e=t.target;a.updateText(e.value),c()});let E="";I.addEventListener("change",t=>{const e=t.target;if(!e.files||e.files.length<1){alert("No image files selected.");return}if(e.files.length>1){alert("One image file at a time.");return}const i=e.files[0],o=URL.createObjectURL(i);p.src=o,p.onload=()=>{E=i.name.slice(0,-3)+"png",w.disabled=!1;const{width:l,height:d}=p;r.canvas.width=l,r.canvas.height=d,g.canvas.width=l,h.style.width=l+"px",s.style.width=l+"px",s.style.height=d+"px",c(),m()}});function m(){r.clearRect(0,0,s.width,s.height),p.src&&r.drawImage(p,0,0);for(let t=0;t<n.placed.length;t++)n.placed[t].drawPin(r);n.held&&n.held.drawPin(r)}function c(){g.clearRect(0,0,g.canvas.width,g.canvas.height),a.drawPin(g),console.log("preview drawn")}
