import"./hoisted.86a25932.js";class v{id;x;y;w;h;text;icon;bg;font;color;constructor(n,i,r,g,f,u){this.id=u??Math.random()*1e3,this.x=n.left,this.y=n.top,this.w=n.width,this.h=n.height,this.text=i,this.icon=new Image,this.icon.src=f,this.bg=r,this.color=g,this.font="16px sans-serif"}updateIcon(n){this.icon.src=n}updateText(n){this.text=n,this.w=n.length*8+50}move(n,i){this.x=n,this.y=i}drawPin(n){n.fillStyle=this.bg,n.fillRect(this.x-24,this.y-this.h/2,this.w,this.h),n.beginPath();const i=this.x+this.w/2-24;n.moveTo(i-10,this.y+5),n.lineTo(i,this.y+25),n.lineTo(i+10,this.y+5),n.closePath(),n.fill(),n.drawImage(this.icon,this.x-20,this.y-12,24,24),n.fillStyle=this.color,n.font=this.font,n.fillText(this.text,this.x+8,this.y+6)}isMouseOver(n,i){return n>this.x-36&&n<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new v({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src)}clone(){return new v({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.id)}}function b(){console.log("init");const o=document.getElementById("pcanvas");if(!o){console.log("no canvas");return}const n=o.getContext("2d"),i=document.getElementById("canvas"),r=i.getContext("2d"),g=document.getElementById("download");g.onclick=()=>{const t=document.createElement("a");t.download=E,t.href=i.toDataURL(),t.click()};const f=document.getElementById("pick"),u=new Image;let h=new v({top:20,left:40,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function a(){n.clearRect(0,0,n.canvas.width,n.canvas.height),h.drawPin(n)}const m=new Image;m.src="/assets/pins/outlined/dot.svg",m.onload=()=>{console.log("icon loaded"),a()};const L=document.getElementById("icons"),I=document.getElementById("pinColor"),B=document.getElementById("txtColor"),C=document.getElementById("pinText"),e={placed:[],held:null,canvasHover:!1,pcanvasHover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1};i.addEventListener("mouseenter",t=>{e.canvasHover=!0}),o.addEventListener("mouseenter",t=>{e.pcanvasHover=!0}),i.addEventListener("mouseleave",t=>{e.canvasHover=!1,e.held&&x()}),o.addEventListener("mouseleave",t=>{e.pcanvasHover=!1,e.held&&(e.held.move(40,20),a())}),i.addEventListener("mousemove",t=>{if(!e.held||!e.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;e.held.move(l,c),y()});let w=!1;o.addEventListener("mousemove",t=>{if(!e.held)return;w=!0;const s=o.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;e.held.move(l,c),a()}),i.addEventListener("mousedown",t=>{if(!e.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;for(let d=0;d<e.placed.length;d++){const p=e.placed[d];if(p.isMouseOver(l,c)){i.style.cursor="grabbing",e.held=p,e.placed.splice(d,1);return}}}),o.addEventListener("mousedown",t=>{const s=o.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;h.isMouseOver(l,c)&&(o.style.cursor="grabbing",e.held=h)});function x(){e.held&&(w?e.placed.push(e.held.twin()):e.placed.push(e.held.clone()),e.held=null,y())}document.addEventListener("mouseup",t=>{if(i.style.cursor="grab",o.style.cursor="grab",!e.held){console.log("no held pin");return}e.canvasHover?x():e.pcanvasHover&&(e.held=null),h.move(40,20),a(),w=!1,e.pin_offset_x=0,e.pin_offset_y=0}),L.addEventListener("change",t=>{const s=t.target;m.src=s.value,h.updateIcon(s.value),a()}),I.addEventListener("change",t=>{const s=t.target;h.bg=s.value,a()}),B.addEventListener("change",t=>{const s=t.target;h.color=s.value,a()}),C.addEventListener("change",t=>{const s=t.target;h.updateText(s.value),a()});let E="";f.addEventListener("change",t=>{const s=t.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const l=s.files[0],c=URL.createObjectURL(l);u.src=c,u.onload=()=>{E=l.name.slice(0,-3)+"png",g.disabled=!1,e.dirty=!0;const{width:d,height:p}=u;r.canvas.width=d,r.canvas.height=p,n.canvas.width=d,o.style.width=d+"px",i.style.width=d+"px",i.style.height=p+"px",a(),y()}});function y(){r.clearRect(0,0,i.width,i.height),u.src&&r.drawImage(u,0,0);for(let t=0;t<e.placed.length;t++)e.placed[t].drawPin(r);e.held&&e.held.drawPin(r)}}b();document.addEventListener("astro:page-load",()=>{console.log("astro page load")});document.addEventListener("astro:after-swap",()=>{console.log("astro page swap"),b()});window.addEventListener("beforeunload",o=>{state.dirty&&(o.preventDefault(),o.returnValue="",alert("Are you sure you want to leave?"))});
