import"./hoisted.Zi3KmiJc.js";class f{id;x;y;w;h;text;icon;bg;font;color;side;constructor(e,i,c,p,v,u,l){this.id=l??Math.random()*1e3,this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=v,this.bg=c,this.color=p,this.side=u??"bottom",this.font="16px sans-serif"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawTip(e){const i=this.x+this.w/2-24;switch(this.side){case"left":e.beginPath(),e.moveTo(i-40,this.y-10),e.lineTo(i-60,this.y),e.lineTo(i-40,this.y+10),e.closePath(),e.fill();break;case"right":e.beginPath(),e.moveTo(i+40,this.y-10),e.lineTo(i+60,this.y),e.lineTo(i+40,this.y+10),e.closePath(),e.fill();break;case"top":e.beginPath(),e.moveTo(i-10,this.y-5),e.lineTo(i,this.y-25),e.lineTo(i+10,this.y-5),e.closePath(),e.fill();break;default:e.beginPath(),e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill();break}}drawBody(e){e.beginPath(),e.roundRect(this.x-24,this.y-this.h/2,this.w,this.h,5),e.closePath(),e.fill()}drawIcon(e){this.color&&(e.filter="invert(1)"),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.filter="none"}drawPin(e){e.fillStyle=this.bg,this.drawTip(e),this.drawBody(e),e.fillStyle=this.color,this.drawIcon(e),e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side)}clone(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side,this.id)}}function k(){console.log("init");const o=document.getElementById("pcanvas");if(!o){console.log("no canvas");return}const e=o.getContext("2d"),i=document.getElementById("canvas"),c=i.getContext("2d"),p=document.getElementById("download");p.onclick=()=>{const t=document.createElement("a");t.download=E,t.href=i.toDataURL(),t.click()};const v=document.getElementById("pick"),u=new Image;let l=new f({top:40,left:40,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function a(){e.clearRect(0,0,e.canvas.width,e.canvas.height),l.drawPin(e)}const m=new Image;m.src="/assets/pins/outlined/dot.svg",m.onload=()=>{console.log("icon loaded"),a()};const I=document.getElementById("sides"),L=document.getElementById("icons"),T=document.getElementById("pinColor"),B=document.getElementById("txtColor"),P=document.getElementById("pinText"),n={placed:[],held:null,canvasHover:!1,pcanvasHover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1};i.addEventListener("mouseenter",t=>{n.canvasHover=!0}),o.addEventListener("mouseenter",t=>{n.pcanvasHover=!0}),i.addEventListener("mouseleave",t=>{n.canvasHover=!1,n.held&&b()}),o.addEventListener("mouseleave",t=>{n.pcanvasHover=!1,n.held&&(n.held.move(40,40),a())}),i.addEventListener("mousemove",t=>{if(!n.held||!n.canvasHover)return;const s=i.getBoundingClientRect(),d=t.clientX-s.left,h=t.clientY-s.top;n.held.move(d,h),y()});let w=!1;o.addEventListener("mousemove",t=>{if(!n.held)return;w=!0;const s=o.getBoundingClientRect(),d=t.clientX-s.left,h=t.clientY-s.top;n.held.move(d,h),a()}),i.addEventListener("mousedown",t=>{if(!n.canvasHover)return;const s=i.getBoundingClientRect(),d=t.clientX-s.left,h=t.clientY-s.top;for(let r=0;r<n.placed.length;r++){const g=n.placed[r];if(g.isMouseOver(d,h)){i.style.cursor="grabbing",n.held=g,n.placed.splice(r,1);return}}}),o.addEventListener("mousedown",t=>{const s=o.getBoundingClientRect(),d=t.clientX-s.left,h=t.clientY-s.top;l.isMouseOver(d,h)&&(o.style.cursor="grabbing",n.held=l)});function b(){n.held&&(w?n.placed.push(n.held.twin()):n.placed.push(n.held.clone()),n.held=null,y())}document.addEventListener("mouseup",t=>{if(i.style.cursor="grab",o.style.cursor="grab",!n.held){console.log("no held pin");return}n.canvasHover?b():n.pcanvasHover&&(n.held=null),l.move(40,40),a(),w=!1,n.pin_offset_x=0,n.pin_offset_y=0}),I.addEventListener("change",t=>{const s=t.target;l.side=s.value,a()}),L.addEventListener("change",t=>{const s=t.target;m.src=s.value,l.updateIcon(s.value),a()}),T.addEventListener("change",t=>{const s=t.target;l.bg=s.value,a()}),B.addEventListener("change",t=>{const s=t.target;l.color=s.value,a()}),P.addEventListener("change",t=>{const s=t.target;l.updateText(s.value),a()});let E="";v.addEventListener("change",t=>{const s=t.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const d=s.files[0],h=URL.createObjectURL(d);u.src=h,u.onload=()=>{E=d.name.slice(0,-3)+"png",p.disabled=!1,n.dirty=!0;const{width:r,height:g}=u;c.canvas.width=r,c.canvas.height=g,e.canvas.width=r,o.style.width=r+"px",i.style.width=r+"px",i.style.height=g+"px",a(),y()}});function y(){c.clearRect(0,0,i.width,i.height),u.src&&c.drawImage(u,0,0);for(let t=0;t<n.placed.length;t++)n.placed[t].drawPin(c);n.held&&n.held.drawPin(c)}window.addEventListener("beforeunload",t=>{n.dirty&&(t.preventDefault(),t.returnValue="",alert("Are you sure you want to leave?"))})}document.addEventListener("astro:page-load",k);
