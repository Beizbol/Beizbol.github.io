import"./hoisted.61ae0013.js";class h{x=0;y=0;constructor(x,n){this.x=x,this.y=n}}class C{turns=[];end;start;constructor(x){this.turns=x,this.start=x[0],this.end=x[x.length-1]}}typeof process<"u"&&(process.env,process.stdout&&process.stdout.isTTY);var p={exports:{}};(function(t){var x={};t.exports=x,x.eastAsianWidth=function(r){var o=r.charCodeAt(0),a=r.length==2?r.charCodeAt(1):0,e=o;return 55296<=o&&o<=56319&&56320<=a&&a<=57343&&(o&=1023,a&=1023,e=o<<10|a,e+=65536),e==12288||65281<=e&&e<=65376||65504<=e&&e<=65510?"F":e==8361||65377<=e&&e<=65470||65474<=e&&e<=65479||65482<=e&&e<=65487||65490<=e&&e<=65495||65498<=e&&e<=65500||65512<=e&&e<=65518?"H":4352<=e&&e<=4447||4515<=e&&e<=4519||4602<=e&&e<=4607||9001<=e&&e<=9002||11904<=e&&e<=11929||11931<=e&&e<=12019||12032<=e&&e<=12245||12272<=e&&e<=12283||12289<=e&&e<=12350||12353<=e&&e<=12438||12441<=e&&e<=12543||12549<=e&&e<=12589||12593<=e&&e<=12686||12688<=e&&e<=12730||12736<=e&&e<=12771||12784<=e&&e<=12830||12832<=e&&e<=12871||12880<=e&&e<=13054||13056<=e&&e<=19903||19968<=e&&e<=42124||42128<=e&&e<=42182||43360<=e&&e<=43388||44032<=e&&e<=55203||55216<=e&&e<=55238||55243<=e&&e<=55291||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65106||65108<=e&&e<=65126||65128<=e&&e<=65131||110592<=e&&e<=110593||127488<=e&&e<=127490||127504<=e&&e<=127546||127552<=e&&e<=127560||127568<=e&&e<=127569||131072<=e&&e<=194367||177984<=e&&e<=196605||196608<=e&&e<=262141?"W":32<=e&&e<=126||162<=e&&e<=163||165<=e&&e<=166||e==172||e==175||10214<=e&&e<=10221||10629<=e&&e<=10630?"Na":e==161||e==164||167<=e&&e<=168||e==170||173<=e&&e<=174||176<=e&&e<=180||182<=e&&e<=186||188<=e&&e<=191||e==198||e==208||215<=e&&e<=216||222<=e&&e<=225||e==230||232<=e&&e<=234||236<=e&&e<=237||e==240||242<=e&&e<=243||247<=e&&e<=250||e==252||e==254||e==257||e==273||e==275||e==283||294<=e&&e<=295||e==299||305<=e&&e<=307||e==312||319<=e&&e<=322||e==324||328<=e&&e<=331||e==333||338<=e&&e<=339||358<=e&&e<=359||e==363||e==462||e==464||e==466||e==468||e==470||e==472||e==474||e==476||e==593||e==609||e==708||e==711||713<=e&&e<=715||e==717||e==720||728<=e&&e<=731||e==733||e==735||768<=e&&e<=879||913<=e&&e<=929||931<=e&&e<=937||945<=e&&e<=961||963<=e&&e<=969||e==1025||1040<=e&&e<=1103||e==1105||e==8208||8211<=e&&e<=8214||8216<=e&&e<=8217||8220<=e&&e<=8221||8224<=e&&e<=8226||8228<=e&&e<=8231||e==8240||8242<=e&&e<=8243||e==8245||e==8251||e==8254||e==8308||e==8319||8321<=e&&e<=8324||e==8364||e==8451||e==8453||e==8457||e==8467||e==8470||8481<=e&&e<=8482||e==8486||e==8491||8531<=e&&e<=8532||8539<=e&&e<=8542||8544<=e&&e<=8555||8560<=e&&e<=8569||e==8585||8592<=e&&e<=8601||8632<=e&&e<=8633||e==8658||e==8660||e==8679||e==8704||8706<=e&&e<=8707||8711<=e&&e<=8712||e==8715||e==8719||e==8721||e==8725||e==8730||8733<=e&&e<=8736||e==8739||e==8741||8743<=e&&e<=8748||e==8750||8756<=e&&e<=8759||8764<=e&&e<=8765||e==8776||e==8780||e==8786||8800<=e&&e<=8801||8804<=e&&e<=8807||8810<=e&&e<=8811||8814<=e&&e<=8815||8834<=e&&e<=8835||8838<=e&&e<=8839||e==8853||e==8857||e==8869||e==8895||e==8978||9312<=e&&e<=9449||9451<=e&&e<=9547||9552<=e&&e<=9587||9600<=e&&e<=9615||9618<=e&&e<=9621||9632<=e&&e<=9633||9635<=e&&e<=9641||9650<=e&&e<=9651||9654<=e&&e<=9655||9660<=e&&e<=9661||9664<=e&&e<=9665||9670<=e&&e<=9672||e==9675||9678<=e&&e<=9681||9698<=e&&e<=9701||e==9711||9733<=e&&e<=9734||e==9737||9742<=e&&e<=9743||9748<=e&&e<=9749||e==9756||e==9758||e==9792||e==9794||9824<=e&&e<=9825||9827<=e&&e<=9829||9831<=e&&e<=9834||9836<=e&&e<=9837||e==9839||9886<=e&&e<=9887||9918<=e&&e<=9919||9924<=e&&e<=9933||9935<=e&&e<=9953||e==9955||9960<=e&&e<=9983||e==10045||e==10071||10102<=e&&e<=10111||11093<=e&&e<=11097||12872<=e&&e<=12879||57344<=e&&e<=63743||65024<=e&&e<=65039||e==65533||127232<=e&&e<=127242||127248<=e&&e<=127277||127280<=e&&e<=127337||127344<=e&&e<=127386||917760<=e&&e<=917999||983040<=e&&e<=1048573||1048576<=e&&e<=1114109?"A":"N"},x.characterLength=function(r){var o=this.eastAsianWidth(r);return o=="F"||o=="W"||o=="A"?2:1};function n(r){return r.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[]}x.length=function(r){for(var o=n(r),a=0,e=0;e<o.length;e++)a=a+this.characterLength(o[e]);return a},x.slice=function(r,o,a){textLen=x.length(r),o=o||0,a=a||1,o<0&&(o=textLen+o),a<0&&(a=textLen+a);for(var e="",c=0,E=n(r),d=0;d<E.length;d++){var v=E[d],u=x.length(v);if(c>=o-(u==2?1:0))if(c+u<=a)e+=v;else break;c+=u}return e}})(p);if(typeof process<"u"){let t=process;"argv"in t&&Array.isArray(t.argv)&&(t.argv.includes("--verbose")||t.argv.includes("--silent"))}class F{x;y;w;h;get center(){return{x:this.x+this.w/2,y:this.y+this.h/2}}name;description;damage=24;range=100;cooldown=0;reload_delay=50;shot_delay=50;price=10;color="darkblue";selected=!0;bullets=[];constructor(x,n,r,o){this.x=x,this.y=n,this.w=r,this.h=o,this.name="Tower",this.description="A tower"}draw(x){x.fillStyle="navy",x.fillRect(this.x,this.y,this.w,this.h)}fire(x){x.damage(this.damage),this.cooldown=this.shot_delay,this.color="purple"}getName(){return this.name}getDescription(){return this.description}}class b{x=0;y=0;size=20;health=100;color="hsl(100, 100%, 50%)";delay=0;value=10;speed=1;shield=0;description;target=0;get isWaiting(){return this.delay>=0}get isDead(){return this.health<=0}constructor(x){this.delay=x,this.description="An enemy"}hasReached(x){return this.x==x.x&&this.y==x.y}kill(){this.health=0}wait(){this.delay-=1}move(x){let n=x.x-this.x,r=x.y-this.y;n==0&&r==0?this.target+=1:n>0?this.x+=this.speed:n<0?this.x-=this.speed:r>0?this.y+=this.speed:r<0&&(this.y-=this.speed)}damage(x){this.shield>0?(this.shield-=x,this.shield<0&&(this.shield=0)):(this.health-=x,this.color=`hsl(${this.health}, 100%, 50%)`)}isAlive(){return this.health>0}}class D{mobs=[];waveDelay=0;remaining=0;living=0;get isOver(){return this.remaining<=0&&this.living<=0}constructor(x,n){const r=x+(n-2)*.125*x;this.remaining=r,this.waveDelay=-5*n-x+100;for(let o=0;o<r;o++)this.mobs.push(new b(this.waveDelay*(o+1)))}spawn(){this.remaining-=1,this.living+=1}kill(x){this.mobs[x].kill(),this.living-=1}}class L{x;y;w;h;towers;constructor(x,n){this.x=0,this.y=n-150,this.w=x,this.h=n,this.towers=[new F(this.x+10,this.y+10,this.w/3-20,this.h-120),new F(this.x+this.w/3+10,this.y+10,this.w/3-20,this.h-120),new F(this.x+2*this.w/3+10,this.y+10,this.w/3-20,this.h-120)]}draw(x){x.fillStyle="black",x.fillRect(this.x,this.y,this.w,this.h);for(let n=0;n<this.towers.length;n++)this.towers[n].draw(x)}}const w=document.getElementById("waveDialog"),l=document.getElementById("canvas"),k=document.getElementById("play"),R=document.getElementById("pause"),A=document.getElementById("lives"),m=document.getElementById("round"),S=document.getElementById("coins"),s=l.getContext("2d",{alpha:!1});let i={x:0,y:0,running:!0,frame:0,lives:100,name:"JTD",description:"A tower defence game.",version:"0.0.1",round:1,shield:0,coins:0,difficulty:2,road:new C([new h(100,0),new h(100,100),new h(500,100),new h(500,200),new h(300,200),new h(300,300),new h(400,300),new h(400,400)]),shop:new L(l.width,l.height),towers:[new F(280,160,30,30)],wave:new D(1,2)};function T(){if(!s){console.error("Canavas not supported :(");return}const t=window.devicePixelRatio,x=l.getBoundingClientRect();l.width=x.width*t,l.height=x.height*t,s.scale(t,t),i.x=l.width/2,i.y=l.height-25,l.addEventListener("click",f),k.addEventListener("click",f),R.addEventListener("click",f),A.innerHTML=i.lives.toString(),m.innerHTML=i.round.toString(),console.log("starting "+i.name),W()}function f(){i.running?(l.classList.add("paused"),g()):(l.classList.remove("paused"),y())}function W(){console.log("Game started"),y()}function M(){console.log("Next Wave"),i.round+=1,m.innerHTML=i.round.toString(),i.wave=new D(i.round,i.difficulty)}w.addEventListener("close",()=>{console.log("close"),M(),y()});function P(){if(i.running){i.wave.isOver&&(console.log("Next Wave"),w.show(),g());for(let t of i.towers){if(t.cooldown>0){t.cooldown-=1,t.color="darkgrey";continue}for(let x=0;x<i.wave.mobs.length;x++){const n=i.wave.mobs[x];if(!(n.isDead||n.isWaiting||I(t,n)>t.range)){if(t.fire(n),n.isDead){i.coins+=n.value,S.innerHTML=i.coins.toString(),i.wave.kill(x),i.wave.isOver&&(console.log("Next Wave"),w.show(),g());continue}break}}}for(let t=0;t<i.wave.mobs.length;t++){const x=i.wave.mobs[t];if(x.isDead)continue;if(x.isWaiting){x.wait(),x.delay==0&&i.wave.spawn();continue}if(x.hasReached(i.road.end)){i.lives-=1,A.innerHTML=i.lives.toString(),i.wave.kill(t);continue}const n=i.road.turns[x.target];n&&x.move(n)}}}function B(){if(!s){console.log("no ctx");return}s.fillStyle="green",s.fillRect(0,0,l.width,l.height);for(let t of i.towers)t.selected&&(s.fillStyle="grey",s.beginPath(),s.arc(t.x,t.y,t.range,0,Math.PI*2),s.fill(),s.closePath()),s.fillStyle=t.color,s.fillRect(t.x,t.y,t.w,t.h);s.fillStyle="white";for(let t=0;t<i.road.turns.length-1;t++){const x=i.road.turns[t],n=i.road.turns[t+1];s.beginPath(),s.moveTo(x.x,x.y),s.lineTo(n.x,n.y),s.stroke()}s.fillStyle="black",s.fillRect(i.road.end.x-40,i.road.end.y,80,40),s.fillStyle="white",s.fillRect(i.road.end.x,i.road.end.y,20,20),s.fillRect(i.road.end.x-40,i.road.end.y,20,20),s.fillRect(i.road.end.x-20,i.road.end.y+20,20,20),s.fillRect(i.road.end.x+20,i.road.end.y+20,20,20);for(let t of i.wave.mobs)t.isDead||t.isWaiting||(s.fillStyle=t.color,s.beginPath(),s.arc(t.x,t.y,10,0,Math.PI*2),s.fill(),s.closePath());i.shop.draw(s),P(),i.frame=window.requestAnimationFrame(B)}function I(t,x){let n=Math.abs(t.x-x.x),r=Math.abs(t.y-x.y);return Math.sqrt(n*n+r*r)}function y(){console.log("resume"),i.running=!0,i.frame=window.requestAnimationFrame(B)}function g(){i.running=!1,window.cancelAnimationFrame(i.frame)}window.addEventListener("load",T);
