import"./hoisted.B1_uNwtp.js";class a{x=0;y=0;constructor(e,s){this.x=e,this.y=s}}class v{turns=[];end;start;constructor(e){this.turns=e,this.start=e[0],this.end=e[e.length-1]}}typeof process<"u"&&process.stdout&&process.stdout.isTTY;class h{x;y;w;h;get center(){return{x:this.x+this.w/2,y:this.y+this.h/2}}name;description;damage=24;range=100;cooldown=0;reload_delay=50;shot_delay=50;price=10;color="darkblue";selected=!0;bullets=[];constructor(e,s,l,r){this.x=e,this.y=s,this.w=l,this.h=r,this.name="Tower",this.description="A tower"}draw(e){e.fillStyle="navy",e.fillRect(this.x,this.y,this.w,this.h)}fire(e){e.damage(this.damage),this.cooldown=this.shot_delay,this.color="purple"}getName(){return this.name}getDescription(){return this.description}}class x{x=0;y=0;size=20;health=100;color="hsl(100, 100%, 50%)";delay=0;value=10;speed=1;shield=0;description;target=0;get isWaiting(){return this.delay>=0}get isDead(){return this.health<=0}constructor(e){this.delay=e,this.description="An enemy"}hasReached(e){return this.x==e.x&&this.y==e.y}kill(){this.health=0}wait(){this.delay-=1}move(e){let s=e.x-this.x,l=e.y-this.y;s==0&&l==0?this.target+=1:s>0?this.x+=this.speed:s<0?this.x-=this.speed:l>0?this.y+=this.speed:l<0&&(this.y-=this.speed)}damage(e){this.shield>0?(this.shield-=e,this.shield<0&&(this.shield=0)):(this.health-=e,this.color=`hsl(${this.health}, 100%, 50%)`)}isAlive(){return this.health>0}}class g{mobs=[];waveDelay=0;remaining=0;living=0;get isOver(){return this.remaining<=0&&this.living<=0}constructor(e,s){const l=e+(s-2)*.125*e;this.remaining=l,this.waveDelay=-5*s-e+100;for(let r=0;r<l;r++)this.mobs.push(new x(this.waveDelay*(r+1)))}spawn(){this.remaining-=1,this.living+=1}kill(e){this.mobs[e].kill(),this.living-=1}}class p{x;y;w;h;towers;constructor(e,s){this.x=0,this.y=s-150,this.w=e,this.h=s,this.towers=[new h(this.x+10,this.y+10,this.w/3-20,this.h-120),new h(this.x+this.w/3+10,this.y+10,this.w/3-20,this.h-120),new h(this.x+2*this.w/3+10,this.y+10,this.w/3-20,this.h-120)]}draw(e){e.fillStyle="black",e.fillRect(this.x,this.y,this.w,this.h);for(let s=0;s<this.towers.length;s++)this.towers[s].draw(e)}}const c=document.getElementById("waveDialog"),o=document.getElementById("canvas"),b=document.getElementById("play"),R=document.getElementById("pause"),f=document.getElementById("lives"),y=document.getElementById("round"),S=document.getElementById("coins"),n=o.getContext("2d",{alpha:!1});let t={x:0,y:0,running:!0,frame:0,lives:100,name:"JTD",description:"A tower defence game.",version:"0.0.1",round:1,shield:0,coins:0,difficulty:2,road:new v([new a(100,0),new a(100,100),new a(500,100),new a(500,200),new a(300,200),new a(300,300),new a(400,300),new a(400,400)]),shop:new p(o.width,o.height),towers:[new h(280,160,30,30)],wave:new g(1,2)};function k(){if(!n){console.error("Canavas not supported :(");return}const i=window.devicePixelRatio,e=o.getBoundingClientRect();o.width=e.width*i,o.height=e.height*i,n.scale(i,i),t.x=o.width/2,t.y=o.height-25,o.addEventListener("click",d),b.addEventListener("click",d),R.addEventListener("click",d),f.innerHTML=t.lives.toString(),y.innerHTML=t.round.toString(),console.log("starting "+t.name),E()}function d(){t.running?(o.classList.add("paused"),w()):(o.classList.remove("paused"),u())}function E(){console.log("Game started"),u()}function D(){console.log("Next Wave"),t.round+=1,y.innerHTML=t.round.toString(),t.wave=new g(t.round,t.difficulty)}c.addEventListener("close",()=>{console.log("close"),D(),u()});function L(){if(t.running){t.wave.isOver&&(console.log("Next Wave"),c.show(),w());for(let i of t.towers){if(i.cooldown>0){i.cooldown-=1,i.color="darkgrey";continue}for(let e=0;e<t.wave.mobs.length;e++){const s=t.wave.mobs[e];if(!(s.isDead||s.isWaiting||T(i,s)>i.range)){if(i.fire(s),s.isDead){t.coins+=s.value,S.innerHTML=t.coins.toString(),t.wave.kill(e),t.wave.isOver&&(console.log("Next Wave"),c.show(),w());continue}break}}}for(let i=0;i<t.wave.mobs.length;i++){const e=t.wave.mobs[i];if(e.isDead)continue;if(e.isWaiting){e.wait(),e.delay==0&&t.wave.spawn();continue}if(e.hasReached(t.road.end)){t.lives-=1,f.innerHTML=t.lives.toString(),t.wave.kill(i);continue}const s=t.road.turns[e.target];s&&e.move(s)}}}function m(){if(!n){console.log("no ctx");return}n.fillStyle="green",n.fillRect(0,0,o.width,o.height);for(let i of t.towers)i.selected&&(n.fillStyle="grey",n.beginPath(),n.arc(i.x,i.y,i.range,0,Math.PI*2),n.fill(),n.closePath()),n.fillStyle=i.color,n.fillRect(i.x,i.y,i.w,i.h);n.fillStyle="white";for(let i=0;i<t.road.turns.length-1;i++){const e=t.road.turns[i],s=t.road.turns[i+1];n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(s.x,s.y),n.stroke()}n.fillStyle="black",n.fillRect(t.road.end.x-40,t.road.end.y,80,40),n.fillStyle="white",n.fillRect(t.road.end.x,t.road.end.y,20,20),n.fillRect(t.road.end.x-40,t.road.end.y,20,20),n.fillRect(t.road.end.x-20,t.road.end.y+20,20,20),n.fillRect(t.road.end.x+20,t.road.end.y+20,20,20);for(let i of t.wave.mobs)i.isDead||i.isWaiting||(n.fillStyle=i.color,n.beginPath(),n.arc(i.x,i.y,10,0,Math.PI*2),n.fill(),n.closePath());t.shop.draw(n),L(),t.frame=window.requestAnimationFrame(m)}function T(i,e){let s=Math.abs(i.x-e.x),l=Math.abs(i.y-e.y);return Math.sqrt(s*s+l*l)}function u(){console.log("resume"),t.running=!0,t.frame=window.requestAnimationFrame(m)}function w(){t.running=!1,window.cancelAnimationFrame(t.frame)}window.addEventListener("load",k);
