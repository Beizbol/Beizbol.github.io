import"./hoisted.86a25932.js";class f{id;x;y;w;h;text;icon;bg;font;color;constructor(e,i,r,p,v,u){this.id=u??Math.random()*1e3,this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=v,this.bg=r,this.color=p,this.font="16px sans-serif"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawPin(e){e.fillStyle=this.bg,e.fillRect(this.x-24,this.y-this.h/2,this.w,this.h),e.beginPath();const i=this.x+this.w/2-24;e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill(),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.fillStyle=this.color,e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src)}clone(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.id)}}function b(){const o=document.getElementById("pcanvas");if(!o){console.log("no canvas");return}const e=o.getContext("2d"),i=document.getElementById("canvas"),r=i.getContext("2d"),p=document.getElementById("download");p.onclick=()=>{const t=document.createElement("a");t.download=E,t.href=i.toDataURL(),t.click()};const v=document.getElementById("pick"),u=new Image;let h=new f({top:20,left:40,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function a(){e.clearRect(0,0,e.canvas.width,e.canvas.height),h.drawPin(e),console.log("preview drawn")}const w=new Image;w.src="/assets/pins/outlined/dot.svg",w.onload=()=>{console.log("icon loaded"),a()};const L=document.getElementById("icons"),I=document.getElementById("pinColor"),B=document.getElementById("txtColor"),C=document.getElementById("pinText"),n={placed:[],held:null,canvasHover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1};i.addEventListener("mouseenter",t=>{n.canvasHover=!0}),i.addEventListener("mouseleave",t=>{n.canvasHover=!1,n.held&&x()}),o.addEventListener("mouseleave",t=>{n.held&&(n.held.move(40,20),a())}),i.addEventListener("mousemove",t=>{if(!n.held||!n.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;n.held.move(l,c),y()});let m=!1;o.addEventListener("mousemove",t=>{if(!n.held)return;m=!0;const s=o.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;n.held.move(l,c),a()}),i.addEventListener("mousedown",t=>{if(!n.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;for(let d=0;d<n.placed.length;d++){const g=n.placed[d];if(g.isMouseOver(l,c)){i.style.cursor="grabbing",n.held=g,n.placed.splice(d,1);return}}}),o.addEventListener("mousedown",t=>{const s=o.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top;h.isMouseOver(l,c)&&(o.style.cursor="grabbing",n.held=h)});function x(){n.held&&(m?n.placed.push(n.held.twin()):n.placed.push(n.held.clone()),n.held=null,y())}document.addEventListener("mouseup",t=>{i.style.cursor="grab",o.style.cursor="grab",n.held&&(n.canvasHover&&x(),h.move(40,20),a(),m=!1,n.pin_offset_x=0,n.pin_offset_y=0)}),L.addEventListener("change",t=>{const s=t.target;w.src=s.value,h.updateIcon(s.value),a()}),I.addEventListener("change",t=>{const s=t.target;h.bg=s.value,a()}),B.addEventListener("change",t=>{const s=t.target;h.color=s.value,a()}),C.addEventListener("change",t=>{const s=t.target;h.updateText(s.value),a()});let E="";v.addEventListener("change",t=>{const s=t.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const l=s.files[0],c=URL.createObjectURL(l);u.src=c,u.onload=()=>{E=l.name.slice(0,-3)+"png",p.disabled=!1,n.dirty=!0;const{width:d,height:g}=u;r.canvas.width=d,r.canvas.height=g,e.canvas.width=d,o.style.width=d+"px",i.style.width=d+"px",i.style.height=g+"px",a(),y()}});function y(){r.clearRect(0,0,i.width,i.height),u.src&&r.drawImage(u,0,0);for(let t=0;t<n.placed.length;t++)n.placed[t].drawPin(r);n.held&&n.held.drawPin(r)}}console.log("raw");b();document.addEventListener("astro:page-load",()=>{console.log("astro page load")});document.addEventListener("astro:after-swap",()=>{console.log("astro page swap"),b()});window.addEventListener("beforeunload",o=>{state.dirty&&(o.preventDefault(),o.returnValue="",alert("Are you sure you want to leave?"))});
