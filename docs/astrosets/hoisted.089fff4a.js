import"./hoisted.d5332371.js";class f{id;x;y;w;h;text;icon;bg;font;color;constructor(e,i,d,u,v,g){this.id=g??Math.random()*1e3,this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=v,this.bg=d,this.color=u,this.font="16px sans-serif"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawPin(e){e.fillStyle=this.bg,e.fillRect(this.x-24,this.y-this.h/2,this.w,this.h),e.beginPath();const i=this.x+this.w/2-24;e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill(),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.fillStyle=this.color,e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src)}clone(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.id)}}function C(){const o=document.getElementById("pcanvas");if(!o){console.log("no canvas");return}const e=o.getContext("2d"),i=document.getElementById("canvas"),d=i.getContext("2d"),u=document.getElementById("download");u.onclick=()=>{const t=document.createElement("a");t.download=E,t.href=i.toDataURL(),t.click()};const v=document.getElementById("pick"),g=new Image;let r=new f({top:20,left:40,width:100,height:30},"Pin Text","Indigo","white","/assets/pins/outlined/dot.svg");function c(){e.clearRect(0,0,e.canvas.width,e.canvas.height),r.drawPin(e),console.log("preview drawn")}const m=new Image;m.src="/assets/pins/outlined/dot.svg",m.onload=()=>{console.log("icon loaded"),c()};const b=document.getElementById("icons"),I=document.getElementById("pinColor"),L=document.getElementById("txtColor"),B=document.getElementById("pinText"),n={placed:[],held:null,canvasHover:!1,pin_offset_x:0,pin_offset_y:0};i.addEventListener("mouseenter",t=>{n.canvasHover=!0}),i.addEventListener("mouseleave",t=>{n.canvasHover=!1,n.held&&x()}),o.addEventListener("mouseleave",t=>{n.held&&(n.held.move(40,20),c())}),i.addEventListener("mousemove",t=>{if(!n.held||!n.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top;n.held.move(l,a),y()});let w=!1;o.addEventListener("mousemove",t=>{if(!n.held)return;w=!0;const s=o.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top;n.held.move(l,a),c()}),i.addEventListener("mousedown",t=>{if(!n.canvasHover)return;const s=i.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top;for(let h=0;h<n.placed.length;h++){const p=n.placed[h];if(p.isMouseOver(l,a)){i.style.cursor="grabbing",n.held=p,n.placed.splice(h,1);return}}}),o.addEventListener("mousedown",t=>{const s=o.getBoundingClientRect(),l=t.clientX-s.left,a=t.clientY-s.top;r.isMouseOver(l,a)&&(o.style.cursor="grabbing",n.held=r)});function x(){n.held&&(w?n.placed.push(n.held.twin()):n.placed.push(n.held.clone()),n.held=null,y())}document.addEventListener("mouseup",t=>{i.style.cursor="grab",o.style.cursor="grab",n.held&&(n.canvasHover&&x(),r.move(40,20),c(),w=!1,n.pin_offset_x=0,n.pin_offset_y=0)}),b.addEventListener("change",t=>{const s=t.target;m.src=s.value,r.updateIcon(s.value),c()}),I.addEventListener("change",t=>{const s=t.target;r.bg=s.value,c()}),L.addEventListener("change",t=>{const s=t.target;r.color=s.value,c()}),B.addEventListener("change",t=>{const s=t.target;r.updateText(s.value),c()});let E="";v.addEventListener("change",t=>{const s=t.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const l=s.files[0],a=URL.createObjectURL(l);g.src=a,g.onload=()=>{E=l.name.slice(0,-3)+"png",u.disabled=!1;const{width:h,height:p}=g;d.canvas.width=h,d.canvas.height=p,e.canvas.width=h,o.style.width=h+"px",i.style.width=h+"px",i.style.height=p+"px",c(),y()}});function y(){d.clearRect(0,0,i.width,i.height),g.src&&d.drawImage(g,0,0);for(let t=0;t<n.placed.length;t++)n.placed[t].drawPin(d);n.held&&n.held.drawPin(d)}}console.log("raw");document.addEventListener("astro:after-swap",()=>{console.log("astro page swap"),C()});
