import"./hoisted.c32bbaa2.js";class f{id;x;y;w;h;text;icon;bg;font;color;constructor(e,i,d,g,v,u){this.id=u??Math.random()*1e3,this.x=e.left,this.y=e.top,this.w=e.width,this.h=e.height,this.text=i,this.icon=new Image,this.icon.src=v,this.bg=d,this.color=g,this.font="16px sans-serif"}updateIcon(e){this.icon.src=e}updateText(e){this.text=e,this.w=e.length*8+50}move(e,i){this.x=e,this.y=i}drawPin(e){e.fillStyle=this.bg,e.beginPath();const i=this.x+this.w/2-24;e.moveTo(i-10,this.y+5),e.lineTo(i,this.y+25),e.lineTo(i+10,this.y+5),e.closePath(),e.fill(),e.beginPath(),e.roundRect(this.x-24,this.y-this.h/2,this.w,this.h,5),e.closePath(),e.fill(),e.fillStyle=this.color,this.color&&(e.filter="invert(1)"),e.drawImage(this.icon,this.x-20,this.y-12,24,24),e.filter="none",e.font=this.font,e.fillText(this.text,this.x+8,this.y+6)}isMouseOver(e,i){return e>this.x-36&&e<this.x-12+this.w&&i>this.y-20&&i<this.y+this.h}twin(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src)}clone(){return new f({left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.id)}}function x(){console.log("init");const o=document.getElementById("pcanvas");if(!o){console.log("no canvas");return}const e=o.getContext("2d"),i=document.getElementById("canvas"),d=i.getContext("2d"),g=document.getElementById("download");g.onclick=()=>{const n=document.createElement("a");n.download=b,n.href=i.toDataURL(),n.click()};const v=document.getElementById("pick"),u=new Image;let h=new f({top:20,left:40,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function a(){e.clearRect(0,0,e.canvas.width,e.canvas.height),h.drawPin(e)}const m=new Image;m.src="/assets/pins/outlined/dot.svg",m.onload=()=>{console.log("icon loaded"),a()};const L=document.getElementById("icons"),I=document.getElementById("pinColor"),B=document.getElementById("txtColor"),C=document.getElementById("pinText"),t={placed:[],held:null,canvasHover:!1,pcanvasHover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1};i.addEventListener("mouseenter",n=>{t.canvasHover=!0}),o.addEventListener("mouseenter",n=>{t.pcanvasHover=!0}),i.addEventListener("mouseleave",n=>{t.canvasHover=!1,t.held&&E()}),o.addEventListener("mouseleave",n=>{t.pcanvasHover=!1,t.held&&(t.held.move(40,20),a())}),i.addEventListener("mousemove",n=>{if(!t.held||!t.canvasHover)return;const s=i.getBoundingClientRect(),l=n.clientX-s.left,c=n.clientY-s.top;t.held.move(l,c),y()});let w=!1;o.addEventListener("mousemove",n=>{if(!t.held)return;w=!0;const s=o.getBoundingClientRect(),l=n.clientX-s.left,c=n.clientY-s.top;t.held.move(l,c),a()}),i.addEventListener("mousedown",n=>{if(!t.canvasHover)return;const s=i.getBoundingClientRect(),l=n.clientX-s.left,c=n.clientY-s.top;for(let r=0;r<t.placed.length;r++){const p=t.placed[r];if(p.isMouseOver(l,c)){i.style.cursor="grabbing",t.held=p,t.placed.splice(r,1);return}}}),o.addEventListener("mousedown",n=>{const s=o.getBoundingClientRect(),l=n.clientX-s.left,c=n.clientY-s.top;h.isMouseOver(l,c)&&(o.style.cursor="grabbing",t.held=h)});function E(){t.held&&(w?t.placed.push(t.held.twin()):t.placed.push(t.held.clone()),t.held=null,y())}document.addEventListener("mouseup",n=>{if(i.style.cursor="grab",o.style.cursor="grab",!t.held){console.log("no held pin");return}t.canvasHover?E():t.pcanvasHover&&(t.held=null),h.move(40,20),a(),w=!1,t.pin_offset_x=0,t.pin_offset_y=0}),L.addEventListener("change",n=>{const s=n.target;m.src=s.value,h.updateIcon(s.value),a()}),I.addEventListener("change",n=>{const s=n.target;h.bg=s.value,a()}),B.addEventListener("change",n=>{const s=n.target;h.color=s.value,a()}),C.addEventListener("change",n=>{const s=n.target;h.updateText(s.value),a()});let b="";v.addEventListener("change",n=>{const s=n.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const l=s.files[0],c=URL.createObjectURL(l);u.src=c,u.onload=()=>{b=l.name.slice(0,-3)+"png",g.disabled=!1,t.dirty=!0;const{width:r,height:p}=u;d.canvas.width=r,d.canvas.height=p,e.canvas.width=r,o.style.width=r+"px",i.style.width=r+"px",i.style.height=p+"px",a(),y()}});function y(){d.clearRect(0,0,i.width,i.height),u.src&&d.drawImage(u,0,0);for(let n=0;n<t.placed.length;n++)t.placed[n].drawPin(d);t.held&&t.held.drawPin(d)}}x();document.addEventListener("astro:page-load",()=>{console.log("astro page load")});document.addEventListener("astro:after-swap",()=>{console.log("astro page swap"),x()});window.addEventListener("beforeunload",o=>{state.dirty&&(o.preventDefault(),o.returnValue="",alert("Are you sure you want to leave?"))});
