import"./hoisted.Yj7bA2Eb.js";class v{id;ctx;x;y;w;h;text;icon;bg;font;color;side;constructor(n,s,u,c,g,m,y,w){this.id=w??Math.random()*1e3,this.ctx=n,this.x=s.left,this.y=s.top,this.w=s.width,this.h=s.height,this.text=u,this.icon=new Image,this.icon.src=m,this.bg=c,this.color=g,this.side=y??"bottom",this.font="16px sans-serif"}updateIcon(n){this.icon.src=n}updateText(n){this.text=n;const s=this.ctx.measureText(n);this.w=s.width+48}move(n,s){this.x=n,this.y=s}drawTip(){const n=this.x+this.w/2-24;switch(this.side){case"left":this.ctx.beginPath(),this.ctx.moveTo(n-40,this.y-10),this.ctx.lineTo(n-60,this.y),this.ctx.lineTo(n-40,this.y+10),this.ctx.closePath(),this.ctx.fill();break;case"right":this.ctx.beginPath(),this.ctx.moveTo(n+40,this.y-10),this.ctx.lineTo(n+60,this.y),this.ctx.lineTo(n+40,this.y+10),this.ctx.closePath(),this.ctx.fill();break;case"top":this.ctx.beginPath(),this.ctx.moveTo(n-10,this.y-5),this.ctx.lineTo(n,this.y-25),this.ctx.lineTo(n+10,this.y-5),this.ctx.closePath(),this.ctx.fill();break;default:this.ctx.beginPath(),this.ctx.moveTo(n-10,this.y+5),this.ctx.lineTo(n,this.y+25),this.ctx.lineTo(n+10,this.y+5),this.ctx.closePath(),this.ctx.fill();break}}drawBody(){this.ctx.beginPath(),this.ctx.roundRect(this.x-24,this.y-this.h/2,this.w,this.h,5),this.ctx.closePath(),this.ctx.fill()}drawIcon(){this.color&&(this.ctx.filter="invert(1)"),console.log("icon",this.icon),this.ctx.drawImage(this.icon,this.x-20,this.y-12,24,24),this.ctx.filter="none"}drawPin(){this.ctx.fillStyle=this.bg,this.drawTip(),this.drawBody(),this.ctx.fillStyle=this.color,this.drawIcon(),this.ctx.font=this.font,this.ctx.fillText(this.text,this.x+8,this.y+6)}isMouseOver(n,s){return n>this.x-36&&n<this.x-12+this.w&&s>this.y-20&&s<this.y+this.h}twin(n){return new v(n,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side)}clone(){return new v(this.ctx,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side,this.id)}}class O{undos;redos;constructor(){this.undos=[],this.redos=[]}update(n){this.redos=[],this.undos.push(n)}undo(){const n=this.undos.pop();if(n)return this.redos.push(n),n;console.log("No more undo")}redo(){const n=this.redos.pop();return n?(this.undos.push(n),n):(console.log("No more redo"),n)}}function M(){const x=document.querySelector("dialog");x.addEventListener("close",()=>{console.log("dialog closed")}),x.showModal();const n=document.getElementById("btnStart");n.addEventListener("click",()=>{console.log("start clicked"),x.close()}),console.log("init");const s=document.getElementById("pcanvas");if(!s){console.log("no canvas");return}const u=s.getContext("2d"),c=document.getElementById("canvas"),g=c.getContext("2d"),m=document.getElementById("download");m.onclick=()=>{const e=document.createElement("a");e.download=R,e.href=c.toDataURL(),e.click()};const y=document.getElementById("zoomIn");y.onclick=()=>{t.zoom*=1.01};const w=document.getElementById("zoomReset");w.onclick=()=>{t.zoom=1};const C=document.getElementById("zoomOut");C.onclick=()=>{t.zoom*=.99};const H=document.getElementById("pick"),p=new Image;let a=new v(u,{top:40,left:40,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function d(){u.clearRect(0,0,u.canvas.width,u.canvas.height),a.drawPin()}const E=new Image;E.src="/assets/pins/outlined/dot.svg",E.onload=()=>{console.log("icon loaded"),d()};const b=document.getElementById("sides"),I=document.getElementById("icons"),B=document.getElementById("pinColor"),L=document.getElementById("txtColor"),_=document.getElementById("pinText"),t={placed:[],held:null,edit_pin:null,canvasHover:!1,pcanvasHover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1,zoom:1,history:new O};c.addEventListener("mouseenter",e=>{t.canvasHover=!0,t.held&&(a.move(40,40),t.held=t.held.twin(g),d())}),s.addEventListener("mouseenter",e=>{t.pcanvasHover=!0}),c.addEventListener("mouseleave",e=>{t.canvasHover=!1,t.held&&T()}),s.addEventListener("mouseleave",e=>{t.pcanvasHover=!1}),document.addEventListener("mousemove",e=>{if(t.held){if(t.canvasHover){const o=c.getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top;t.held.move(i,l),r()}if(t.pcanvasHover){const o=s.getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top;t.held.move(i,l),d()}}}),c.addEventListener("mousedown",e=>{if(!t.canvasHover)return;const o=c.getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top;for(let h=0;h<t.placed.length;h++){const f=t.placed[h];if(f.isMouseOver(i,l)){c.style.cursor="grabbing",t.held=f,t.placed.splice(h,1),k();return}}}),s.addEventListener("mousedown",e=>{const o=s.getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top;a.isMouseOver(i,l)&&(s.style.cursor="grabbing",t.held=a,k())});function T(){if(!t.held)return;const e=s.getBoundingClientRect(),o=t.held.x,i=t.held.y+e.top;P(o,i);const l=t.held.clone();t.placed.push(l),z(l),t.held=null,r()}function z(e){t.edit_pin=e,b.value=e.side,console.log(e.icon.src);const o=e.icon.src.indexOf("/assets");if(o<0){console.log("no assets");return}const i=e.icon.src.slice(o);I.value=i,B.value=e.bg,L.value=e.color,_.value=e.text}function P(e,o){const i=document.getElementById("edit");i.style.top=o+"px",i.style.left=e+"px",i.classList.add("show")}function k(){const e=document.getElementById("edit");e.classList.contains("show")&&(e.classList.remove("show"),t.edit_pin=null)}document.addEventListener("mouseup",e=>{if(c.style.cursor="grab",s.style.cursor="grab",!t.held){console.log("no held pin");return}if(t.canvasHover)T();else if(t.pcanvasHover){t.held=null,a.move(40,40);const o=s.getBoundingClientRect(),i=a.x+o.left,l=a.y+o.top;t.edit_pin=a,P(i,l),d()}t.pin_offset_x=0,t.pin_offset_y=0}),b.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const o=e.target;t.edit_pin.side=o.value,d(),r(),console.log("side changed")}),I.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const o=e.target;console.log(o.value),t.edit_pin.updateIcon(o.value),d(),r(),console.log("icon changed")}),B.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const o=e.target;t.edit_pin.bg=o.value,d(),r(),console.log("color changed")}),L.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const o=e.target;t.edit_pin.color=o.value,t.history.update(t.placed),d(),r(),console.log("text color changed")}),_.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const o=e.target;t.edit_pin.updateText(o.value),d(),r(),console.log("text changed")});let R="";H.addEventListener("change",e=>{const o=e.target;if(!o.files||o.files.length<1){alert("No image files selected.");return}if(o.files.length>1){alert("One image file at a time.");return}const i=o.files[0],l=URL.createObjectURL(i);p.src=l,p.onload=()=>{R=i.name.slice(0,-3)+"png",m.disabled=!1,t.dirty=!0;const{width:h,height:f}=p;g.canvas.width=h,g.canvas.height=f,u.canvas.width=h,s.style.width=h+"px",c.style.width=h+"px",c.style.height=f+"px",d(),r(),n.disabled=!1}});function r(){g.clearRect(0,0,c.width,c.height),p.src&&g.drawImage(p,0,0);for(let e=0;e<t.placed.length;e++)t.placed[e].drawPin();t.held&&t.held.drawPin()}window.addEventListener("beforeunload",e=>{t.dirty&&(e.preventDefault(),e.returnValue="",alert("Are you sure you want to leave?"))})}document.addEventListener("astro:page-load",M);
