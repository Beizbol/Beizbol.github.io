import"./hoisted.CcPGgC7n.js";class g{id;ctx;x;y;w;h;text;icon;bg;font_size;color;side;static scale=1.69;constructor(n,i,r,w,p,L,E,d){this.id=d??Math.random()*1e6,this.ctx=n,this.x=i.left,this.y=i.top,this.w=i.width,this.h=i.height,this.text=r,this.icon=new Image,this.icon.src=L,this.icon.onload=()=>{this.drawIcon()},this.bg=w,this.color=p,this.side=E??"bottom",this.font_size=16}updateIcon(n){this.icon.src=n}updateText(n){this.text=n;const i=this.ctx.measureText(n);this.w=i.width+48}move(n,i){this.x=n,this.y=i}drawTip(){const n=g.scale,i=this.x+n*this.w/2-n*24;switch(this.side){case"left":this.ctx.beginPath(),this.ctx.moveTo(i-n*40,this.y-n*10),this.ctx.lineTo(i-n*60,this.y),this.ctx.lineTo(i-n*40,this.y+n*10),this.ctx.closePath(),this.ctx.fill();break;case"right":this.ctx.beginPath(),this.ctx.moveTo(i+n*40,this.y-n*10),this.ctx.lineTo(i+n*60,this.y),this.ctx.lineTo(i+n*40,this.y+n*10),this.ctx.closePath(),this.ctx.fill();break;case"top":this.ctx.beginPath(),this.ctx.moveTo(i-n*10,this.y-n*5),this.ctx.lineTo(i,this.y-n*25),this.ctx.lineTo(i+n*10,this.y-n*5),this.ctx.closePath(),this.ctx.fill();break;default:this.ctx.beginPath(),this.ctx.moveTo(i-n*10,this.y+n*5),this.ctx.lineTo(i,this.y+n*25),this.ctx.lineTo(i+n*10,this.y+n*5),this.ctx.closePath(),this.ctx.fill();break}}drawBody(){const n=g.scale;this.ctx.beginPath(),this.ctx.roundRect(this.x-n*24,this.y-n*this.h/2,n*this.w,n*this.h,n*5),this.ctx.closePath(),this.ctx.fill()}drawIcon(){this.color&&(this.ctx.filter="invert(1)");const n=g.scale;this.ctx.drawImage(this.icon,this.x-n*20,this.y-n*12,n*24,n*24),this.ctx.filter="none"}drawPin(){this.ctx.fillStyle=this.bg,this.drawTip(),this.drawBody(),this.ctx.fillStyle=this.color,this.drawIcon();const n=g.scale,i=this.font_size*n;this.ctx.font=`${i}px sans-serif`,this.ctx.fillText(this.text,this.x+n*8,this.y+n*6)}isMouseOver(n,i){const r=g.scale;return n>this.x-r*30&&n<this.x-r*16+r*this.w&&i>this.y-r*20&&i<this.y+r*this.h}twin(n){return new g(n,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side)}clone(){return new g(this.ctx,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side,this.id)}}function q(){const y=document.getElementById("hi-menu");y.addEventListener("close",()=>{console.log("hi dialog closed")}),n();function n(){const e=localStorage.getItem("show-hi");e&&e==="never"?console.log("show-hi:",e):y.showModal()}const i=document.getElementById("again");i.addEventListener("change",e=>{const s=i.checked?"never":"yes";console.log("checked:",i.checked,s),localStorage.setItem("show-hi",s)});const r=document.getElementById("open-menu");r.addEventListener("close",()=>{console.log("help dialog closed")});const w=document.getElementById("help-menu");w.addEventListener("close",()=>{console.log("help dialog closed")});const p=document.getElementById("save-menu");p.addEventListener("close",()=>{console.log("save dialog closed:",p.returnValue),p.returnValue==="save"&&B()}),document.getElementById("btnEsc").addEventListener("click",()=>{p.close()});const E=document.getElementById("btnStart");E.addEventListener("click",()=>{console.log("start clicked"),t.placed=[],t.held=null,_(),h()});const d=document.getElementById("pcanvas"),m=d.getContext("2d"),l=document.getElementById("canvas"),v=l.getContext("2d");document.onkeyup=e=>{e.ctrlKey&&e.key==="s"&&B()};const D=document.getElementById("open");D.onclick=()=>{r.showModal()};function B(){const e=document.createElement("a");e.download=O,e.href=l.toDataURL(),e.click()}const b=document.getElementById("review"),k=document.getElementById("save");k.onclick=()=>{b.style.width=l.width+"px",b.style.aspectRatio=l.width/l.height+"",p.showModal(),setTimeout(()=>{b.style.backgroundImage="none",b.src=l.toDataURL()},1)};const U=document.getElementById("help");U.onclick=()=>{console.log("help"),w.showModal(),console.log("help dialog opened")};const X=document.getElementById("pick"),x=new Image;let u=new g(m,{top:40,left:60,width:100,height:30},"Pin Text","#7711BB","#FFFFFF","/assets/pins/outlined/dot.svg");function a(){m.clearRect(0,0,m.canvas.width,m.canvas.height),u.drawPin()}const T=new Image;T.src="/assets/pins/outlined/dot.svg",T.onload=()=>{console.log("icon loaded"),a()};const R=document.getElementById("sides"),C=document.getElementById("icons"),P=document.getElementById("pinColor"),z=document.getElementById("txtColor"),M=document.getElementById("pinText"),t={placed:[],held:null,edit_pin:null,canvas_hover:!1,pcanvas_hover:!1,edit_hover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1,scaleImg:!1};l.addEventListener("mouseenter",e=>{t.canvas_hover=!0,t.held&&(u.move(60,40),t.held=t.held.twin(v),a())}),d.addEventListener("mouseenter",e=>{t.pcanvas_hover=!0}),l.addEventListener("mouseleave",e=>{t.canvas_hover=!1,t.held&&(console.log("left canvas"),t.held=null,h())}),d.addEventListener("mouseleave",e=>{t.pcanvas_hover=!1}),document.addEventListener("mousemove",e=>{if(t.held){if(t.canvas_hover){const s=l.getBoundingClientRect(),c=e.clientX-s.left,o=e.clientY-s.top;t.held.move(c,o),h()}if(t.pcanvas_hover){const s=d.getBoundingClientRect(),c=e.clientX-s.left,o=e.clientY-s.top;t.held.move(c,o),a()}}}),l.addEventListener("mousedown",e=>{if(!t.canvas_hover)return;const s=l.getBoundingClientRect(),c=e.clientX-s.left,o=e.clientY-s.top;for(let I=0;I<t.placed.length;I++){const S=t.placed[I];if(S.isMouseOver(c,o)){l.style.cursor="grabbing",t.held=S,t.placed.splice(I,1),_();return}}}),d.addEventListener("mousedown",e=>{const s=d.getBoundingClientRect(),c=e.clientX-s.left,o=e.clientY-s.top;u.isMouseOver(c,o)&&(d.style.cursor="grabbing",t.held=u,_())});function Y(){if(!t.held)return;const e=d.getBoundingClientRect(),s=t.held.x,c=t.held.y+e.top;F(s,c);const o=t.held.clone();t.placed.push(o),j(o),t.held=null,h()}function j(e){t.edit_pin=e,R.value=e.side;const s=e.icon.src.indexOf("/assets");if(s<0){console.log("no assets");return}const c=e.icon.src.slice(s);C.value=c,P.value=e.bg,z.value=e.color,M.value=e.text}const f=document.getElementById("edit");f.addEventListener("mouseenter",e=>{t.edit_hover=!0}),f.addEventListener("mouseleave",e=>{t.edit_hover=!1});function F(e,s){f.style.top=s+"px",f.style.left=e+"px",f.classList.add("show")}function _(){f.classList.contains("show")&&(f.classList.remove("show"),t.edit_pin=null)}document.addEventListener("mouseup",e=>{if(l.style.cursor="grab",d.style.cursor="grab",!t.held){t.edit_hover||_();return}if(t.canvas_hover)Y();else if(t.pcanvas_hover){t.held=null,u.move(60,40);const s=d.getBoundingClientRect(),c=u.x+s.left,o=u.y+s.top;t.edit_pin=u,F(c,o),a()}t.pin_offset_x=0,t.pin_offset_y=0}),R.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const s=e.target;t.edit_pin.side=s.value,a(),h(),console.log("side changed")}),C.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const s=e.target;console.log(s.value),t.edit_pin.updateIcon(s.value),a(),h(),console.log("icon changed")}),P.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const s=e.target;t.edit_pin.bg=s.value,a(),h(),console.log("color changed")}),z.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const s=e.target;t.edit_pin.color=s.value,a(),h(),console.log("text color changed")}),M.addEventListener("change",e=>{if(!t.edit_pin){console.log("no pin");return}const s=e.target;t.edit_pin.updateText(s.value),a(),h(),console.log("text changed")}),document.getElementById("sizes").addEventListener("change",e=>{const s=e.target;g.scale=parseFloat(s.value),a(),h(),console.log("size changed")});let O="";X.addEventListener("change",e=>{const s=e.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const c=s.files[0],o=URL.createObjectURL(c);x.src=o,x.onload=()=>{O=c.name.slice(0,-3)+"jpg",k.disabled=!1,t.dirty=!0,V(x),a(),h(),E.disabled=!1}});function V(e){const{width:s,height:c}=e;let o=1;s<600&&(o=600/s),v.canvas.width=o*s,v.canvas.height=o*c,m.canvas.width=o*s,d.style.width=o*s+"px",l.style.width=o*s+"px",l.style.height=o*c+"px"}function h(){v.clearRect(0,0,l.width,l.height),x.src&&v.drawImage(x,0,0,v.canvas.width,v.canvas.height);for(let e=0;e<t.placed.length;e++)t.placed[e].drawPin();t.held&&t.held.drawPin()}console.log("adding event listener"),window.addEventListener("beforeunload",e=>{e.preventDefault(),t.dirty&&console.log("dirty"),y.open&&(e.preventDefault(),y.close(),console.log("closed hi"))})}document.addEventListener("astro:page-load",q);
