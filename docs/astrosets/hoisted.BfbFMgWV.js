import"./hoisted.CCz-6gw8.js";class g{id;ctx;x;y;w;h;text;icon;bg;font_size;color;side;static scale=1;constructor(n,i,r,d,v,l,u,E){this.id=E??Math.random()*1e6,this.ctx=n,this.x=i.left,this.y=i.top,this.w=i.width,this.h=i.height,this.text=r,this.icon=new Image,this.icon.src=l,this.icon.onload=()=>{this.drawIcon()},this.bg=d,this.color=v,this.side=u??"bottom",this.font_size=16}updateIcon(n){this.icon.src=n}updateText(n){this.text=n;const i=this.ctx.measureText(n);this.w=i.width+48}move(n,i){this.x=n,this.y=i}drawTip(){const n=g.scale,i=this.x+n*this.w/2-n*24;switch(this.side){case"left":this.ctx.beginPath(),this.ctx.moveTo(i-n*40,this.y-n*10),this.ctx.lineTo(i-n*60,this.y),this.ctx.lineTo(i-n*40,this.y+n*10),this.ctx.closePath(),this.ctx.fill();break;case"right":this.ctx.beginPath(),this.ctx.moveTo(i+n*40,this.y-n*10),this.ctx.lineTo(i+n*60,this.y),this.ctx.lineTo(i+n*40,this.y+n*10),this.ctx.closePath(),this.ctx.fill();break;case"top":this.ctx.beginPath(),this.ctx.moveTo(i-n*10,this.y-n*5),this.ctx.lineTo(i,this.y-n*25),this.ctx.lineTo(i+n*10,this.y-n*5),this.ctx.closePath(),this.ctx.fill();break;default:this.ctx.beginPath(),this.ctx.moveTo(i-n*10,this.y+n*5),this.ctx.lineTo(i,this.y+n*25),this.ctx.lineTo(i+n*10,this.y+n*5),this.ctx.closePath(),this.ctx.fill();break}}drawBody(){const n=g.scale;this.ctx.beginPath(),this.ctx.roundRect(this.x-n*24,this.y-n*this.h/2,n*this.w,n*this.h,n*5),this.ctx.closePath(),this.ctx.fill()}drawIcon(){this.color&&(this.ctx.filter="invert(1)");const n=g.scale;this.ctx.drawImage(this.icon,this.x-n*20,this.y-n*12,n*24,n*24),this.ctx.filter="none"}drawPin(){this.ctx.fillStyle=this.bg,this.drawTip(),this.drawBody(),this.ctx.fillStyle=this.color,this.drawIcon();const n=g.scale,i=this.font_size*n;this.ctx.font=`${i}px sans-serif`,this.ctx.fillText(this.text,this.x+n*8,this.y+n*6)}isMouseOver(n,i){const r=g.scale;return n>this.x-r*30&&n<this.x-r*16+r*this.w&&i>this.y-r*20&&i<this.y+r*this.h}twin(n){return new g(n,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side)}clone(){return new g(this.ctx,{left:this.x,top:this.y,width:this.w,height:this.h},this.text,this.bg,this.color,this.icon.src,this.side,this.id)}}function D(){const m=document.getElementById("hi-menu");m.addEventListener("close",()=>{console.log("hi dialog closed")}),m.showModal();const n=document.getElementById("open-menu");n.addEventListener("close",()=>{console.log("help dialog closed")});const i=document.getElementById("help-menu");i.addEventListener("close",()=>{console.log("help dialog closed")});const r=document.getElementById("btnStart");r.addEventListener("click",()=>{console.log("start clicked"),e.placed=[],e.held=null,y(),h()});const d=document.getElementById("pcanvas"),v=d.getContext("2d"),l=document.getElementById("canvas"),u=l.getContext("2d");document.onkeyup=t=>{t.ctrlKey&&t.key==="s"&&b()};const E=document.getElementById("open");E.onclick=()=>{n.showModal()};const _=document.getElementById("save");function b(){const t=document.createElement("a");t.download=P,t.href=l.toDataURL(),t.click()}_.onclick=b;const M=document.getElementById("help");M.onclick=()=>{console.log("help"),i.showModal(),console.log("help dialog opened")};const O=document.getElementById("pick"),x=new Image;let p=new g(v,{top:40,left:60,width:100,height:30},"Pin Text","#7711BB","white","/assets/pins/outlined/dot.svg");function a(){v.clearRect(0,0,v.canvas.width,v.canvas.height),p.drawPin()}const I=new Image;I.src="/assets/pins/outlined/dot.svg",I.onload=()=>{console.log("icon loaded"),a()};const L=document.getElementById("sides"),B=document.getElementById("icons"),k=document.getElementById("pinColor"),T=document.getElementById("txtColor"),C=document.getElementById("pinText"),e={placed:[],held:null,edit_pin:null,canvas_hover:!1,pcanvas_hover:!1,edit_hover:!1,pin_offset_x:0,pin_offset_y:0,dirty:!1,scaleImg:!1};l.addEventListener("mouseenter",t=>{e.canvas_hover=!0,e.held&&(p.move(60,40),e.held=e.held.twin(u),a())}),d.addEventListener("mouseenter",t=>{e.pcanvas_hover=!0}),l.addEventListener("mouseleave",t=>{e.canvas_hover=!1,e.held&&(console.log("left canvas"),e.held=null,h())}),d.addEventListener("mouseleave",t=>{e.pcanvas_hover=!1}),document.addEventListener("mousemove",t=>{if(e.held){if(e.canvas_hover){const s=l.getBoundingClientRect(),c=t.clientX-s.left,o=t.clientY-s.top;e.held.move(c,o),h()}if(e.pcanvas_hover){const s=d.getBoundingClientRect(),c=t.clientX-s.left,o=t.clientY-s.top;e.held.move(c,o),a()}}}),l.addEventListener("mousedown",t=>{if(!e.canvas_hover)return;const s=l.getBoundingClientRect(),c=t.clientX-s.left,o=t.clientY-s.top;for(let w=0;w<e.placed.length;w++){const z=e.placed[w];if(z.isMouseOver(c,o)){l.style.cursor="grabbing",e.held=z,e.placed.splice(w,1),y();return}}}),d.addEventListener("mousedown",t=>{const s=d.getBoundingClientRect(),c=t.clientX-s.left,o=t.clientY-s.top;p.isMouseOver(c,o)&&(d.style.cursor="grabbing",e.held=p,y())});function S(){if(console.log("placing pin"),!e.held)return;const t=d.getBoundingClientRect(),s=e.held.x,c=e.held.y+t.top;R(s,c);const o=e.held.clone();e.placed.push(o),X(o),e.held=null,h(),console.log("pin placed")}function X(t){e.edit_pin=t,L.value=t.side;const s=t.icon.src.indexOf("/assets");if(s<0){console.log("no assets");return}const c=t.icon.src.slice(s);B.value=c,k.value=t.bg,T.value=t.color,C.value=t.text}const f=document.getElementById("edit");f.addEventListener("mouseenter",t=>{e.edit_hover=!0}),f.addEventListener("mouseleave",t=>{e.edit_hover=!1});function R(t,s){f.style.top=s+"px",f.style.left=t+"px",f.classList.add("show")}function y(){f.classList.contains("show")&&(f.classList.remove("show"),e.edit_pin=null)}document.addEventListener("mouseup",t=>{if(l.style.cursor="grab",d.style.cursor="grab",!e.held){e.edit_hover||y();return}if(e.canvas_hover)S();else if(e.pcanvas_hover){e.held=null,p.move(60,40);const s=d.getBoundingClientRect(),c=p.x+s.left,o=p.y+s.top;e.edit_pin=p,R(c,o),a()}e.pin_offset_x=0,e.pin_offset_y=0}),L.addEventListener("change",t=>{if(!e.edit_pin){console.log("no pin");return}const s=t.target;e.edit_pin.side=s.value,a(),h(),console.log("side changed")}),B.addEventListener("change",t=>{if(!e.edit_pin){console.log("no pin");return}const s=t.target;console.log(s.value),e.edit_pin.updateIcon(s.value),a(),h(),console.log("icon changed")}),k.addEventListener("change",t=>{if(!e.edit_pin){console.log("no pin");return}const s=t.target;e.edit_pin.bg=s.value,a(),h(),console.log("color changed")}),T.addEventListener("change",t=>{if(!e.edit_pin){console.log("no pin");return}const s=t.target;e.edit_pin.color=s.value,a(),h(),console.log("text color changed")}),C.addEventListener("change",t=>{if(!e.edit_pin){console.log("no pin");return}const s=t.target;e.edit_pin.updateText(s.value),a(),h(),console.log("text changed")}),document.getElementById("sizes").addEventListener("change",t=>{const s=t.target;g.scale=parseFloat(s.value),a(),h(),console.log("size changed")});let P="";O.addEventListener("change",t=>{const s=t.target;if(!s.files||s.files.length<1){alert("No image files selected.");return}if(s.files.length>1){alert("One image file at a time.");return}const c=s.files[0],o=URL.createObjectURL(c);x.src=o,x.onload=()=>{P=c.name.slice(0,-3)+"jpg",_.disabled=!1,e.dirty=!0,Y(x),a(),h(),r.disabled=!1}});function Y(t){const{width:s,height:c}=t;let o=1;s<600&&(o=600/s),u.canvas.width=o*s,u.canvas.height=o*c,v.canvas.width=o*s,d.style.width=o*s+"px",l.style.width=o*s+"px",l.style.height=o*c+"px"}function h(){u.clearRect(0,0,l.width,l.height),x.src&&u.drawImage(x,0,0,u.canvas.width,u.canvas.height);for(let t=0;t<e.placed.length;t++)e.placed[t].drawPin();e.held&&e.held.drawPin()}console.log("adding event listener"),window.addEventListener("beforeunload",t=>{t.preventDefault(),t.returnValue="Are you sure you want to leave?",e.dirty&&console.log("dirty"),m.open&&(t.preventDefault(),t.returnValue="",m.close(),console.log("closed hi"))})}document.addEventListener("astro:page-load",D);
