import"./hoisted.CmKvcf_A.js";class r{x=0;y=0;constructor(e,s){this.x=e,this.y=s}}class v{turns=[];end;start;constructor(e){this.turns=e,this.start=e[0],this.end=e[e.length-1]}}typeof process<"u"&&process.stdout&&process.stdout.isTTY;if(typeof process<"u"){let t=process;"argv"in t&&Array.isArray(t.argv)&&(t.argv.includes("--verbose")||t.argv.includes("--silent"))}class h{x;y;w;h;get center(){return{x:this.x+this.w/2,y:this.y+this.h/2}}name;description;damage=24;range=100;cooldown=0;reload_delay=50;shot_delay=50;price=10;color="darkblue";selected=!0;bullets=[];constructor(e,s,l,a){this.x=e,this.y=s,this.w=l,this.h=a,this.name="Tower",this.description="A tower"}draw(e){e.fillStyle="navy",e.fillRect(this.x,this.y,this.w,this.h)}fire(e){e.damage(this.damage),this.cooldown=this.shot_delay,this.color="purple"}getName(){return this.name}getDescription(){return this.description}}class p{x=0;y=0;size=20;health=100;color="hsl(100, 100%, 50%)";delay=0;value=10;speed=1;shield=0;description;target=0;get isWaiting(){return this.delay>=0}get isDead(){return this.health<=0}constructor(e){this.delay=e,this.description="An enemy"}hasReached(e){return this.x==e.x&&this.y==e.y}kill(){this.health=0}wait(){this.delay-=1}move(e){let s=e.x-this.x,l=e.y-this.y;s==0&&l==0?this.target+=1:s>0?this.x+=this.speed:s<0?this.x-=this.speed:l>0?this.y+=this.speed:l<0&&(this.y-=this.speed)}damage(e){this.shield>0?(this.shield-=e,this.shield<0&&(this.shield=0)):(this.health-=e,this.color=`hsl(${this.health}, 100%, 50%)`)}isAlive(){return this.health>0}}class f{mobs=[];waveDelay=0;remaining=0;living=0;get isOver(){return this.remaining<=0&&this.living<=0}constructor(e,s){const l=e+(s-2)*.125*e;this.remaining=l,this.waveDelay=-5*s-e+100;for(let a=0;a<l;a++)this.mobs.push(new p(this.waveDelay*(a+1)))}spawn(){this.remaining-=1,this.living+=1}kill(e){this.mobs[e].kill(),this.living-=1}}class x{x;y;w;h;towers;constructor(e,s){this.x=0,this.y=s-150,this.w=e,this.h=s,this.towers=[new h(this.x+10,this.y+10,this.w/3-20,this.h-120),new h(this.x+this.w/3+10,this.y+10,this.w/3-20,this.h-120),new h(this.x+2*this.w/3+10,this.y+10,this.w/3-20,this.h-120)]}draw(e){e.fillStyle="black",e.fillRect(this.x,this.y,this.w,this.h);for(let s=0;s<this.towers.length;s++)this.towers[s].draw(e)}}const c=document.getElementById("waveDialog"),o=document.getElementById("canvas"),b=document.getElementById("play"),R=document.getElementById("pause"),g=document.getElementById("lives"),y=document.getElementById("round"),S=document.getElementById("coins"),n=o.getContext("2d",{alpha:!1});let i={x:0,y:0,running:!0,frame:0,lives:100,name:"JTD",description:"A tower defence game.",version:"0.0.1",round:1,shield:0,coins:0,difficulty:2,road:new v([new r(100,0),new r(100,100),new r(500,100),new r(500,200),new r(300,200),new r(300,300),new r(400,300),new r(400,400)]),shop:new x(o.width,o.height),towers:[new h(280,160,30,30)],wave:new f(1,2)};function k(){if(!n){console.error("Canavas not supported :(");return}const t=window.devicePixelRatio,e=o.getBoundingClientRect();o.width=e.width*t,o.height=e.height*t,n.scale(t,t),i.x=o.width/2,i.y=o.height-25,o.addEventListener("click",d),b.addEventListener("click",d),R.addEventListener("click",d),g.innerHTML=i.lives.toString(),y.innerHTML=i.round.toString(),console.log("starting "+i.name),E()}function d(){i.running?(o.classList.add("paused"),w()):(o.classList.remove("paused"),u())}function E(){console.log("Game started"),u()}function D(){console.log("Next Wave"),i.round+=1,y.innerHTML=i.round.toString(),i.wave=new f(i.round,i.difficulty)}c.addEventListener("close",()=>{console.log("close"),D(),u()});function L(){if(i.running){i.wave.isOver&&(console.log("Next Wave"),c.show(),w());for(let t of i.towers){if(t.cooldown>0){t.cooldown-=1,t.color="darkgrey";continue}for(let e=0;e<i.wave.mobs.length;e++){const s=i.wave.mobs[e];if(!(s.isDead||s.isWaiting||T(t,s)>t.range)){if(t.fire(s),s.isDead){i.coins+=s.value,S.innerHTML=i.coins.toString(),i.wave.kill(e),i.wave.isOver&&(console.log("Next Wave"),c.show(),w());continue}break}}}for(let t=0;t<i.wave.mobs.length;t++){const e=i.wave.mobs[t];if(e.isDead)continue;if(e.isWaiting){e.wait(),e.delay==0&&i.wave.spawn();continue}if(e.hasReached(i.road.end)){i.lives-=1,g.innerHTML=i.lives.toString(),i.wave.kill(t);continue}const s=i.road.turns[e.target];s&&e.move(s)}}}function m(){if(!n){console.log("no ctx");return}n.fillStyle="green",n.fillRect(0,0,o.width,o.height);for(let t of i.towers)t.selected&&(n.fillStyle="grey",n.beginPath(),n.arc(t.x,t.y,t.range,0,Math.PI*2),n.fill(),n.closePath()),n.fillStyle=t.color,n.fillRect(t.x,t.y,t.w,t.h);n.fillStyle="white";for(let t=0;t<i.road.turns.length-1;t++){const e=i.road.turns[t],s=i.road.turns[t+1];n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(s.x,s.y),n.stroke()}n.fillStyle="black",n.fillRect(i.road.end.x-40,i.road.end.y,80,40),n.fillStyle="white",n.fillRect(i.road.end.x,i.road.end.y,20,20),n.fillRect(i.road.end.x-40,i.road.end.y,20,20),n.fillRect(i.road.end.x-20,i.road.end.y+20,20,20),n.fillRect(i.road.end.x+20,i.road.end.y+20,20,20);for(let t of i.wave.mobs)t.isDead||t.isWaiting||(n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,10,0,Math.PI*2),n.fill(),n.closePath());i.shop.draw(n),L(),i.frame=window.requestAnimationFrame(m)}function T(t,e){let s=Math.abs(t.x-e.x),l=Math.abs(t.y-e.y);return Math.sqrt(s*s+l*l)}function u(){console.log("resume"),i.running=!0,i.frame=window.requestAnimationFrame(m)}function w(){i.running=!1,window.cancelAnimationFrame(i.frame)}window.addEventListener("load",k);
